# K9s Plugins - Trimmed essentials
# See: https://k9scli.io/topics/plugins/

plugins:
  # Multi-pod log tailing (requires: stern)
  stern:
    shortCut: Shift-L
    description: "Tail logs with stern"
    scopes:
      - pods
    command: stern
    background: false
    args:
      - --tail
      - "100"
      - --context
      - $CONTEXT
      - --namespace
      - $NAMESPACE
      - $FILTER

  # Decode secret and view
  decode-secret:
    shortCut: Shift-X
    description: "Decode secret"
    scopes:
      - secrets
    command: bash
    background: false
    args:
      - -c
      - |
        kubectl get secret $NAME --context $CONTEXT -n $NAMESPACE -o json | \
        jq -r '.data | to_entries[] | "\(.key):\n\(.value | @base64d)\n"' | less

  # Rollout restart
  restart:
    shortCut: Shift-R
    description: "Rollout restart"
    scopes:
      - deployments
      - daemonsets
      - statefulsets
    command: kubectl
    background: false
    confirm: true
    args:
      - rollout
      - restart
      - --context
      - $CONTEXT
      - --namespace
      - $NAMESPACE
      - $RESOURCE_NAME/$NAME

  # Debug with netshoot
  debug-netshoot:
    shortCut: Shift-D
    description: "Debug with netshoot"
    scopes:
      - pods
    command: kubectl
    background: false
    args:
      - debug
      - -it
      - --context
      - $CONTEXT
      - --namespace
      - $NAMESPACE
      - $NAME
      - --image=nicolaka/netshoot
      - --target=$NAME
      - --
      - /bin/bash
