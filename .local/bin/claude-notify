#!/bin/bash
# Claude Code completion notification
# Reads hook JSON from stdin

input=$(cat)

# Debug log
echo "$input" > /tmp/claude-hook-debug.json

# Check for loop prevention
stop_hook_active=$(echo "$input" | jq -r '.stop_hook_active // false')
if [ "$stop_hook_active" = "true" ]; then
    exit 0
fi

# Get tmux context
if tmux display-message -p '#{session_name}' &>/dev/null; then
    SESSION=$(tmux display-message -p '#{session_name}')
    WINDOW=$(tmux display-message -p '#{window_name}')
    DIR=$(basename "$(tmux display-message -p '#{pane_current_path}')")
else
    SESSION="claude"
    WINDOW=""
    DIR=$(basename "$PWD")
fi

# Build title
if [ -n "$WINDOW" ]; then
    TITLE="Claude done - $SESSION:$WINDOW"
else
    TITLE="Claude done - $SESSION"
fi

notify-send -u normal "$TITLE" "üìÅ $DIR"
